

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>fontinfo &mdash; FontCreator</title>
    
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="FontCreator" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../index.html">
            <img class="logo" src="../_static/headertext.png" alt="Logo"/>
          </a></p>
        <div class="headertitle"><a
          href="../index.html">FontCreator</a></div>
        <div class="rel">
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for fontinfo</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Copyright @ 2013 Mathias Westerdahl</span>

<span class="sd">The font info reads the .fontinfo and creates the layers, effects, and blends</span>

<span class="sd">.. py:attribute:: name = &#39;&#39;</span>

<span class="sd">    The path of the font file. Relative paths are relative to the .fontinfo file. Supports .ttf files.</span>
<span class="sd">    For a complete list of supported formats, see `Freetype2 &lt;http://www.freetype.org/freetype2/index.html&gt;`_</span>

<span class="sd">.. py:attribute:: size = 32</span>

<span class="sd">    The size of the font (in pixels)</span>
<span class="sd">    </span>
<span class="sd">.. py:attribute:: leading = 0.0</span>

<span class="sd">    The leading of the font.</span>
<span class="sd">    </span>
<span class="sd">.. py:attribute:: tracking = 0.0</span>

<span class="sd">    The tracking of the font.</span>

<span class="sd">.. py:attribute:: dpi = 72</span>

<span class="sd">    The resolution of the font when being rendered.</span>

<span class="sd">.. py:attribute:: padding = 0</span>

<span class="sd">    The amount of padding that is inserted between two glyphs when rendered to the bitmap.</span>

<span class="sd">.. py:attribute:: internalpadding = 0, 0</span>

<span class="sd">    The amount of padding (x, y) that is added *internally* for a glyph.</span>
<span class="sd">    E.g. making room for manual fixup in a image editing program.</span>

<span class="sd">.. py:attribute:: useadvanceaswidth = 0</span>

<span class="sd">    For japanese fonts, the space in the glyph is important.</span>
<span class="sd">    Therefore, this flag was introduced to respect the space of a glyph.</span>
<span class="sd">    Set to 1 for Japanese fonts.</span>
<span class="sd">    </span>
<span class="sd">.. py:attribute:: usepairkernings = 1</span>

<span class="sd">    Enables the collecting of the pair kernings table.</span>

<span class="sd">.. py:attribute:: letters = 20-7e</span>

<span class="sd">    Specifies what letters should be included in the font. It can hold these formats:</span>
<span class="sd">    </span>
<span class="sd">    #. A list of hexadecimal digits. The list is comma separated and can specify ranges with the &#39;-&#39; character::</span>
<span class="sd">    </span>
<span class="sd">        letters = 20-7c,7d,7e</span>
<span class="sd">        </span>
<span class="sd">    #. A filename. The file contains the actual letters.</span>

<span class="sd">.. py:attribute:: bgcolor = 0, 0, 0</span>

<span class="sd">    The background color of the texture</span>

<span class="sd">.. py:attribute:: fgcolor = 1, 1, 1</span>
<span class="sd">    </span>
<span class="sd">    The color of the glyph</span>
<span class="sd">        </span>
<span class="sd">.. py:attribute:: antialias = normal</span>

<span class="sd">    Enables antialiasing for the glyph rendering (the first pass).</span>
<span class="sd">    Possible values are **&#39;none&#39;, &#39;light&#39; and &#39;normal&#39;**.</span>
<span class="sd">    </span>
<span class="sd">.. py:attribute:: texturerender = fonttex_bitmap</span>
<span class="sd">    </span>
<span class="sd">    A path to the module that renders the glyphs to the texture. Must implement a *image = render(info)* function.</span>
<span class="sd">    The default is :doc:`fonttex_bitmap`</span>

<span class="sd">.. py:attribute:: texturewriter = fonttexout_pil</span>

<span class="sd">    A path to the module that writes the texture to disc. Must implement a *write(options, info, image)* function.</span>
<span class="sd">    The default is :doc:`fonttexout_pil`</span>

<span class="sd">.. py:attribute:: writer = fontout_json</span>
<span class="sd">    </span>
<span class="sd">    A path to the module that writes the glyph info. Must implement a *write(options, info, pairkernings)* function.</span>
<span class="sd">    The default is :doc:`fontout_json`</span>
<span class="sd">    </span>
<span class="sd">.. py:attribute:: layers = &#39;&#39;</span>

<span class="sd">    A list of layers (:py:class:`fonteffects.Layer`) that will be applied in order.</span>
<span class="sd">        </span>
<span class="sd">.. py:attribute:: effects = &#39;&#39;</span>

<span class="sd">    A list of post effects that will be applied in order, after the layers have been rendered.</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">struct</span>
<span class="kn">from</span> <span class="nn">ConfigParser</span> <span class="kn">import</span> <span class="n">SafeConfigParser</span>
<span class="kn">from</span> <span class="nn">fontutils</span> <span class="kn">import</span> <span class="n">FontException</span>
<span class="kn">import</span> <span class="nn">fontblend</span>
<span class="kn">import</span> <span class="nn">fonteffects</span>


<span class="k">def</span> <span class="nf">GetDefaultOptions</span><span class="p">():</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;not set&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;32&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;leading&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0.0&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;tracking&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0.0&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;72&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;internalpadding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0, 0&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;useadvanceaswidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span>  <span class="c"># E.g. set to 1 for japanese fonts</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;usepairkernings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;1&#39;</span>
    
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;letters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;20-7e&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;bgcolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0, 0, 0&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;fgcolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;1, 1, 1&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;antialias&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;normal&#39;</span>

    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;writer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;fontout_json&#39;</span>
    
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;texturerender&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;fonttex_bitmap&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;texturesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;512, 512&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;textureoffset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0, 0&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;usepremultipliedalpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span>
    
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;texturewriter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;fonttexout_pil&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;textureformat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;.png&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;texturechannels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;RGBA&#39;</span>
    
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;posteffects&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">defaults</span>


<div class="viewcode-block" id="SFontInfo"><a class="viewcode-back" href="../modules/fontinfo.html#fontinfo.SFontInfo">[docs]</a><span class="k">class</span> <span class="nc">SFontInfo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The input format (.fontinfo)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reads the font info and converts the info into usable members in this struct &quot;&quot;&quot;</span>
        
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">input</span><span class="p">),</span> <span class="s">&quot;The file doesn&#39;t exist: </span><span class="si">%s</span><span class="se">\n</span><span class="s">Cwd: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="n">GetDefaultOptions</span><span class="p">()</span>

        <span class="n">cfg</span> <span class="o">=</span> <span class="n">SafeConfigParser</span><span class="p">()</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">defaults</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">functionlist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">sections</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">section</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>

            <span class="nb">vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">section</span><span class="p">))</span>
            <span class="nb">vars</span><span class="p">[</span><span class="s">&#39;section&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">section</span>

            <span class="n">typename</span> <span class="o">=</span> <span class="nb">vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">typename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FontException</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: There is no type specified&quot;</span> <span class="o">%</span> <span class="n">section</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cls</span> <span class="o">=</span> <span class="n">fonteffects</span><span class="o">.</span><span class="n">GetClassByName</span><span class="p">(</span><span class="n">typename</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FontException</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: There is no function type named </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">typename</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">functionlist</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="o">**</span><span class="nb">vars</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">functionlist</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">section</span>

        <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">functionlist</span> <span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">fontblend</span><span class="o">.</span><span class="n">BLENDFUNCTIONS</span> <span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;Layer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fonteffects</span><span class="o">.</span><span class="n">Layer</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="s">&#39;layers&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FontException</span><span class="p">(</span><span class="s">&quot;A font must have at least one layer&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;default&quot;</span><span class="p">,</span> <span class="s">&quot;layers&quot;</span><span class="p">),</span> <span class="n">d</span><span class="p">,</span> <span class="n">d</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="s">&#39;posteffects&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">posteffects</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;default&quot;</span><span class="p">,</span> <span class="s">&quot;posteffects&quot;</span><span class="p">),</span> <span class="n">d</span><span class="p">,</span> <span class="n">d</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">posteffects</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">input</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">leading</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leading</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracking</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracking</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">texturesize</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">texturesize</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textureoffset</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">textureoffset</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">texturerender</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">texturerender</span><span class="p">)</span>
        <span class="n">texturerender</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">texturerender</span><span class="p">,</span> <span class="s">&#39;render&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">texturerender</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FontException</span><span class="p">(</span><span class="s">&quot;The module </span><span class="si">%s</span><span class="s"> doesn&#39;t implement render()&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">texturerender</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">texturerender</span> <span class="o">=</span> <span class="n">texturerender</span>
        
        <span class="n">texturewriter</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">texturewriter</span><span class="p">)</span>
        <span class="n">texturewriter</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">texturewriter</span><span class="p">,</span> <span class="s">&#39;write&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">texturewriter</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FontException</span><span class="p">(</span><span class="s">&quot;The module </span><span class="si">%s</span><span class="s"> doesn&#39;t implement write()&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">texturewriter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">texturewriter</span> <span class="o">=</span> <span class="n">texturewriter</span>

        <span class="n">basedir</span><span class="p">,</span> <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">basedir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">basedir</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basedir</span><span class="p">)</span>
        <span class="n">basename</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="s">&#39;write&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FontException</span><span class="p">(</span><span class="s">&quot;The module </span><span class="si">%s</span><span class="s"> doesn&#39;t implement write()&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">writer</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internalpadding</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">internalpadding</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useadvanceaswidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">useadvanceaswidth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usepairkernings</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usepairkernings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usepremultipliedalpha</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usepremultipliedalpha</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mf">255.0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mf">255.0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span> <span class="p">)</span>

        <span class="n">letters_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">letters</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">letters</span><span class="p">):</span>
            <span class="n">letters_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">input</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">letters</span> <span class="p">)</span>
                                      
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">letters_path</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">letters_path</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">f</span><span class="o">.</span><span class="n">FontException</span><span class="p">(</span><span class="s">&quot;The file &#39;</span><span class="si">%s</span><span class="s">&#39; was empty&quot;</span> <span class="o">%</span> <span class="n">letters_path</span><span class="p">)</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">letters</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">]</span>
            <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                <span class="n">letters</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">]</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">letters</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">letters</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">limits</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">letters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">letters</span> <span class="o">+=</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">letters</span> <span class="o">=</span> <span class="n">letters</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">letters</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FontException</span><span class="p">(</span><span class="s">&quot;There were no letters specified!&quot;</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">ReadFormat</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">format</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">format</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>


<span class="k">class</span> <span class="nc">SPackedFontInfo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texturename</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">texture</span> <span class="o">=</span> <span class="n">texturename</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sizepixels</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">size</span>     <span class="c"># the size in pixels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sizefont</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">fontsize</span>   <span class="c"># the size of the font</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">padding</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">texturesize</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">texturesize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ascender</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">ascender</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descender</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">descender</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">maxsize</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">texturesize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sizepixels</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sizefont</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ascender</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descender</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">endian</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;64s256s&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">texture</span> <span class="p">)</span>

        <span class="c"># 16 bytes</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;BBBBbBBxHHxxxx&#39;</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">sizepixels</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">sizefont</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">ascender</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">descender</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">maxsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">maxsize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">texturesize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">texturesize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                              <span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">endian</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">texture</span> <span class="o">=</span> <span class="n">ReadFormat</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;64s256s&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">texture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">texture</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">texture</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ascender</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">descender</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxsize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">texturesize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">texturesize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReadFormat</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;BBBBbBBxHHxxxx&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SFontChar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;HHBBbb&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">glyph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">glyph</span><span class="p">,</span> <span class="s">&#39;bitmapbox&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">utf8</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">utf8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">advanceX</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">advance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearingY</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">bearingY</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span> <span class="bp">False</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">utf8</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">advanceX</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearingY</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">endian</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span> <span class="n">endian</span> <span class="o">+</span> <span class="n">SFontChar</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">advanceX</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">bearingY</span>
                                                <span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="s">&#39;=&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">advanceX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearingY</span> <span class="o">=</span> <span class="n">ReadFormat</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">endian</span> <span class="o">+</span> <span class="n">SFontChar</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SFont</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texture</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">glyphs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">kernings</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">texture</span> <span class="ow">and</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">SPackedFontInfo</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glyphs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chars</span> <span class="o">=</span> <span class="p">[</span> <span class="n">SFontChar</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span> <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">glyphs</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernings</span> <span class="o">=</span> <span class="n">kernings</span> <span class="k">if</span> <span class="n">kernings</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">endian</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="n">endian</span> <span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;HH&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chars</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernings</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span>

        <span class="n">pointeroffset_chars</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s">&#39;IIII&#39;</span><span class="p">)</span>
        <span class="n">pointeroffset_chars_glyphs</span> <span class="o">=</span> <span class="n">pointeroffset_chars</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s">&#39;H&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chars</span><span class="p">)</span>
        <span class="n">pointeroffset_kerning_chars</span> <span class="o">=</span> <span class="n">pointeroffset_chars_glyphs</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">SFontChar</span><span class="o">.</span><span class="n">format</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chars</span><span class="p">)</span>
        <span class="n">pointeroffset_kerning_values</span> <span class="o">=</span> <span class="n">pointeroffset_kerning_chars</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernings</span><span class="p">)</span>

        <span class="c">#print self.info.texture, pointeroffset_chars, pointeroffset_chars_glyphs, pointeroffset_kerning_chars, pointeroffset_kerning_values</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;IIII&#39;</span><span class="p">,</span> <span class="n">pointeroffset_chars</span><span class="p">,</span> <span class="n">pointeroffset_chars_glyphs</span><span class="p">,</span> <span class="n">pointeroffset_kerning_chars</span><span class="p">,</span> <span class="n">pointeroffset_kerning_values</span> <span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span>

        <span class="n">chars</span><span class="p">,</span> <span class="n">glyphs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span> <span class="o">*</span><span class="p">[</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">utf8</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chars</span><span class="p">]</span> <span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;H&#39;</span><span class="p">,</span> <span class="n">char</span> <span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">glyph</span> <span class="ow">in</span> <span class="n">glyphs</span><span class="p">:</span>
            <span class="n">glyph</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="n">endian</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernings</span><span class="p">:</span>
            <span class="n">chars</span><span class="p">,</span> <span class="n">kernings</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernings</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">char</span> <span class="p">)</span>

            <span class="k">for</span> <span class="n">kerning</span> <span class="ow">in</span> <span class="n">kernings</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">kerning</span> <span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="s">&#39;=&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reads a font from a .fntb file.</span>
<span class="sd">        This implementation is very Python specific, do not use it in your c/c++ code.</span>
<span class="sd">        Instead, do a single read of the file into a sufficient char* buffer, and then cast the buffer into a SFont object.</span>
<span class="sd">        Next, you should patch the pointers (to the glyphs and kerning chars/values)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">SPackedFontInfo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="n">endian</span> <span class="p">)</span>

        <span class="n">len_chars</span><span class="p">,</span> <span class="n">len_kernings</span> <span class="o">=</span> <span class="n">ReadFormat</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;HH&#39;</span><span class="p">)</span>

        <span class="n">pointeroffset_chars</span><span class="p">,</span> <span class="n">pointeroffset_chars_glyphs</span><span class="p">,</span> <span class="n">pointeroffset_kerning_chars</span><span class="p">,</span> <span class="n">pointeroffset_kerning_values</span> <span class="o">=</span> <span class="n">ReadFormat</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;IIII&#39;</span><span class="p">)</span>

        <span class="n">chars</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">len_chars</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">len_chars</span><span class="p">):</span>
            <span class="n">chars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReadFormat</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;H&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">len_chars</span><span class="p">):</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">SFontChar</span><span class="p">()</span>
            <span class="n">char</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">endian</span><span class="p">)</span>
            <span class="n">glyphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        print self.info.name</span>
<span class="sd">        for index, (char, glyph) in enumerate( zip(chars, glyphs) ):</span>
<span class="sd">            print &quot;%d: char %c %d  x,y: %d, %d  w,h: %d, %d  adv: %d&quot; % ( index, char, int(char), glyph.x, glyph.y, glyph.width, glyph.height, glyph.advanceX )</span>
<span class="sd">        print &quot;&quot;</span>
<span class="sd">        print &quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chars</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">kerning_chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">ReadFormat</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;I&#39;</span> <span class="o">*</span> <span class="n">len_kernings</span><span class="p">))</span>
        <span class="n">kerning_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">ReadFormat</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">endian</span> <span class="o">+</span> <span class="s">&#39;i&#39;</span> <span class="o">*</span> <span class="n">len_kernings</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="nb">zip</span><span class="p">(</span><span class="n">kerning_chars</span><span class="p">,</span> <span class="n">kerning_values</span><span class="p">)</span> <span class="p">)</span>


<span class="k">def</span> <span class="nf">Extension</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;.fntb&#39;</span>


<span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">pairkernings</span><span class="p">):</span>
    <span class="n">font</span> <span class="o">=</span> <span class="n">SFont</span><span class="p">(</span> <span class="n">options</span><span class="o">.</span><span class="n">texturename</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">glyphs</span><span class="p">,</span> <span class="n">pairkernings</span> <span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="n">options</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
    <span class="n">font</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">endian</span> <span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div>

          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure.html">2. The structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extensions.html">3. Extending the framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download.html">4. Download &amp; Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">5. Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/examples.html">6. Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">7. Credits</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="../search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../genindex.html" title="General Index"
             >index</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2013, Mathias Westerdahl.
      Last updated on Mar 23, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>